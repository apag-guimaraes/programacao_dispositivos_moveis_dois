= Permissões

Um aplicativo no sistema Android pode usar alguns recursos disponíveis como: 

- câmera;

- galeria de fotos;

- arquivos;

- localização do dispositivo e outros.

Para alguns recursos é necessário solicitar acesso ao usuário, isto é feito através das permissões. As permissões são declaradas no arquivo 
Android Manifest.xml e algumas são solicitadas em tempo de execução.

Como consta na documentação oficial (Google Developers), existem 3 tipos de permissões:

- permissões em tempo de instalação: "Quando você declara as permissões no momento da instalação, o sistema automaticamente concede-as quando o usuário 
instala o app.";

- permissões de execução: "[...] conhecidas como permissões perigosas [...] você precisa solicitar permissões de execução no app antes de acessar os dados
restritos ou realizar ações restritas." 	

- permissões especiais: "Somente a plataforma e os OEMs podem definir permissões especiais."

Referência do texto entre aspas: GOOGLE DEVELOPERS. Permissões no Android. Disponível em: 
https://developer.android.com/guide/topics/permissions/overview?hl=pt-br>. Acesso em: 25 ago. 2025.

Permissões no Android

image::https://img.youtube.com/vi/zCAx4WZ98rs/0.jpg[width=640, height=480, link="https://www.youtube.com/watch?v=zCAx4WZ98rs"]

Solicitar permissões

image::https://img.youtube.com/vi/x38dYUm7tCY/0.jpg[width=640, height=480, link="https://www.youtube.com/watch?v=x38dYUm7tCY"]

Permissões em Tempo de Execução

image::https://img.youtube.com/vi/C8lUdPVSzDk/0.jpg[width=640, height=480, link="https://www.youtube.com/watch?v=C8lUdPVSzDk"]


Exemplo 01:

- No arquivo AndroidManifest.xml acrescente : <uses-feature
        android:name="android.hardware.camera"
        android:required="false" />
    <uses-permission android:name="android.permission.CAMERA" />

- PermissionDialogFragment.java
[source,java]
import android.app.Dialog;
import android.content.DialogInterface;
import android.os.Bundle;
import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.appcompat.app.AlertDialog;
import androidx.fragment.app.DialogFragment;
public class PermissaoDialogFragment extends DialogFragment {
    @NonNull
    @Override
    public Dialog onCreateDialog(@Nullable Bundle savedInstanceState) {
        return new AlertDialog.Builder(requireContext())
                .setTitle("Permissão Necessária")
                .setMessage("A permissão da câmera é necessária para tirar fotos.")
                .setPositiveButton("Fechar", new DialogInterface.OnClickListener() {
                    @Override
                    public void onClick(DialogInterface dialog, int which) {
                        requireActivity().finish();
                    }
                })
                .create();
    }
}

- activity_main.xml
[source,xml]
<?xml version="1.0" encoding="utf-8"?>
<androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    tools:context=".MainActivity">
    <Button
        android:id="@+id/buttonHello"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="Abrir Câmera"
        app:layout_constraintTop_toTopOf="parent"
        app:layout_constraintBottom_toBottomOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent"/>
</androidx.constraintlayout.widget.ConstraintLayout>

- MainActivity.java
[source,java]
import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;
import androidx.core.app.ActivityCompat;
import androidx.core.content.ContextCompat;
import android.Manifest;
import android.content.Intent;
import android.content.pm.PackageManager;
import android.os.Bundle;
import android.widget.Button;
public class MainActivity extends AppCompatActivity {
    private static final int CODIGO_SOLICITACAO = 1;
    private static final String PERMISSAO = Manifest.permission.CAMERA;
    private Button button;
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        button = findViewById(R.id.buttonHello);
        button.setOnClickListener(v -> solicitarPermissao());
    }
    private void solicitarPermissao() {
        int temPermissao = ContextCompat.checkSelfPermission(this, PERMISSAO);
        if (temPermissao != PackageManager.PERMISSION_GRANTED) {
            ActivityCompat.requestPermissions(this, new String[]{PERMISSAO}, CODIGO_SOLICITACAO);
        } else {
            chamarActivity();
        }
    }
    private void chamarActivity() {
        Intent i = new Intent(getApplicationContext(), SegundaActivity.class);
        startActivity(i);
    }
    @Override
    public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions,
                                           @NonNull int[] grantResults) {
        super.onRequestPermissionsResult(requestCode, permissions, grantResults);
        if (requestCode == CODIGO_SOLICITACAO) {
            if (grantResults.length > 0 && grantResults[0] == PackageManager.PERMISSION_GRANTED) {
                chamarActivity();
            } else {
                PermissaoDialogFragment dialog = new PermissaoDialogFragment();
                dialog.show(getSupportFragmentManager(), "PermissaoDialog");
            }
        }
    }
}

- activity_segunda.xml
[source,xml]
<?xml version="1.0" encoding="utf-8"?>
<androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    tools:context=".SegundaActivity">
    <ImageView
        android:id="@+id/imageViewFoto"
        android:layout_width="300dp"
        android:layout_height="400dp"
        android:scaleType="centerCrop"
        android:contentDescription="Foto da câmera"
        app:layout_constraintTop_toTopOf="parent"
        app:layout_constraintBottom_toBottomOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent"/>
</androidx.constraintlayout.widget.ConstraintLayout>

- SegundaActivity.java
[source,java]
import androidx.activity.result.ActivityResult;
import androidx.activity.result.ActivityResultCallback;
import androidx.activity.result.ActivityResultLauncher;
import androidx.activity.result.contract.ActivityResultContracts;
import androidx.appcompat.app.AppCompatActivity;
import android.content.Intent;
import android.graphics.Bitmap;
import android.os.Build;
import android.os.Bundle;
import android.provider.MediaStore;
import android.widget.ImageView;
public class SegundaActivity extends AppCompatActivity {
    private ImageView imageView;
    private final ActivityResultLauncher<Intent> cameraLauncher =
            registerForActivityResult(new ActivityResultContracts.StartActivityForResult(),
                    new ActivityResultCallback<ActivityResult>() {
                        @Override
                        public void onActivityResult(ActivityResult result) {
                            if (result.getResultCode() == RESULT_OK && result.getData() != null) {
                                Intent data = result.getData();
                                Bitmap foto = null;
                                if (Build.VERSION.SDK_INT >= 33) {
                                    foto = data.getParcelableExtra("data", Bitmap.class);
                                } else {
                                    foto = (Bitmap) data.getParcelableExtra("data");
                                }
                                if (foto != null) {
                                    imageView.setImageBitmap(foto);
                                }
                            }
                        }
                    });
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_segunda);
        imageView = findViewById(R.id.imageViewFoto);
        Intent intent = new Intent(MediaStore.ACTION_IMAGE_CAPTURE);
        cameraLauncher.launch(intent);
    }
}

Exemplo 02:

- No arquivo AndroidManifest.xml acrescente: 
<uses-feature
        android:name="android.hardware.telephony"
        android:required="false" />
    <uses-permission android:name="android.permission.CALL_PHONE" />

- PermissionDialogPermission.java
[source,java]
import android.app.Dialog;
import android.content.DialogInterface;
import android.os.Bundle;
import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.appcompat.app.AlertDialog;
import androidx.fragment.app.DialogFragment;
public class PermissionDialogFragment extends DialogFragment {
    @NonNull
    @Override
    public Dialog onCreateDialog(@Nullable Bundle savedInstanceState) {
        return new AlertDialog.Builder(requireContext())
                .setTitle("Permissão Necessária")
                .setMessage("A permissão para realizar chamadas é essencial para o funcionamento deste app.")
                .setPositiveButton("OK", new DialogInterface.OnClickListener() {
                    @Override
                    public void onClick(DialogInterface dialog, int which) {
                        dialog.dismiss(); // Apenas fecha o alerta, o usuário pode tentar novamente
                    }
                })
                .create();
    }
}

- activity_main.xml
[source,.xml]
<?xml version="1.0" encoding="utf-8"?>
<androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    android:layout_width="match_parent"
    android:layout_height="match_parent">
    <Button
        android:id="@+id/btnChamada"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="Ligar"
        app:layout_constraintTop_toTopOf="parent"
        app:layout_constraintBottom_toBottomOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent"/>
</androidx.constraintlayout.widget.ConstraintLayout>

- MainActivity.java
[source,java]
import android.Manifest;
import android.content.Intent;
import android.content.pm.PackageManager;
import android.net.Uri;
import android.os.Bundle;
import android.widget.Button;
import android.widget.Toast;
import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;
import androidx.core.app.ActivityCompat;
import androidx.core.content.ContextCompat;
public class MainActivity extends AppCompatActivity {
    private static final String PERMISSAO = Manifest.permission.CALL_PHONE;
    private static final int REQUEST_PERMISSION = 100;
    private static final String TELEFONE_FIXO = "tel:+55DDNUMBER";
    private Button btnChamada;
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        btnChamada = findViewById(R.id.btnChamada);
        btnChamada.setOnClickListener(v -> verificarPermissao());
    }
    private void verificarPermissao() {
        int granted = ContextCompat.checkSelfPermission(this, PERMISSAO);
        if (granted == PackageManager.PERMISSION_GRANTED) {
            fazerLigacao();
        } else {
            ActivityCompat.requestPermissions(this,
                    new String[]{PERMISSAO},
                    REQUEST_PERMISSION);
        }
    }
    private void fazerLigacao() {
        try {
            Intent intent = new Intent(Intent.ACTION_CALL, Uri.parse(TELEFONE_FIXO));
            startActivity(intent);
        } catch (SecurityException e) {
            Toast.makeText(this, "Permissão negada para ligação.", Toast.LENGTH_SHORT).show();
        }
    }
    // Callback do pedido de permissão
    @Override
    public void onRequestPermissionsResult(int requestCode,
                                           @NonNull String[] permissions,
                                           @NonNull int[] grantResults) {
        super.onRequestPermissionsResult(requestCode, permissions, grantResults);
        if (requestCode == REQUEST_PERMISSION) {
            if (grantResults.length > 0 && grantResults[0] == PackageManager.PERMISSION_GRANTED) {
                fazerLigacao();
            } else {
                PermissionDialogFragment dialog = new PermissionDialogFragment();
                dialog.show(getSupportFragmentManager(), "dialog_permission");
            }
        }
    }
}


- Análise da classe PermissionUtils.java, disponível no seguinte endereço: https://github.com/googlemaps/android-samples/blob/main/ApiDemos/java/app/src/gms/java/com/example/mapdemo/PermissionUtils.java. 



