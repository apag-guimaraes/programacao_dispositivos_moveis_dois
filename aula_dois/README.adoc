//caminho padrão para imagens
:imagesdir: images
:figure-caption: Figura
:doctype: book

//gera apresentacao
//pode se baixar os arquivos e add no diretório
:revealjsdir: https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.8.0

//GERAR ARQUIVOS
//make slides
//make ebook

= Padrão MVVM

Trata-se de um padrão de projeto arquitetural, as camadas são divididas em Model, View e View-Model.

Model: Responsável pela manipulação dos dados. Nesta parte compreendem as classes que representam as entidades e que realizam as persistências no banco de dados.

View: Parte visual do projeto. A View relaciona-se com o ViewModel e não conhece diretamente o Model.

ViewModel: Camada intermediária entre a View e o Model. O ViewModel pode ter acesso ao Model diretamente. O ViewModel atualiza o objeto LiveData através da atualização do Model. O LiveData usa o método observe para atualizar a View. 

Para mais detalhes sobre MVVM acesse o material: SOUTO, Thiago. Arquiteturas em Android: MVVM + Kotlin + Android Architecture Components (Databinding, Lifecycle, LiveData, Room). 2019. Disponível em: <https://medium.com/android-dev-br/arquiteturas-em-android-mvvm-kotlin-android-architecture-components-databinding-lifecycle-d5e7a9023cf3>.Acessao em 25 ago. 2025.

Responsabilidades de alguns componentes dentro do MVVM:

- DataBinding: permite o vínculo da View (por exemplo, um TextView) com um ViewModel. O vínculo é feito de forma declarativa no XML.
- LiveData: é um tipo que pode ser observado. Isso significa que os componentes da UI (como Activities e Fragments) podem se inscrever para receber atualizações sobre mudanças nos dados. Notifica apenas os observadores que estão em um estado ativo.

O MVVM garante que a interface do usuário seja sempre atualizada de acordo com o ciclo de vida do componente.

Exemplo prático 01 (com DataBinding e ViewModel):

Inicialmente no projeto criado habilite o DataBinding, no arquivo gradle a nível de app, acrescente as seguintes linhas:
[source,xml]
android{ ... 
   buildFeatures {
        dataBinding = true
    }
}

- activity_main.xml
[source,xml]
<?xml version="1.0" encoding="utf-8"?>
<layout xmlns:android="http://schemas.android.com/apk/res/android">
    <data>
        <variable
            name="viewModel"
            type="nomeDoPacote.CalculadoraViewModel" />
    </data>
    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:orientation="vertical"
        android:padding="16dp">
        <EditText
            android:id="@+id/editTextN1"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:hint="Número 1"
            android:inputType="numberDecimal" />
        <EditText
            android:id="@+id/editTextN2"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:hint="Número 2"
            android:inputType="numberDecimal" />
        <EditText
            android:id="@+id/editTextOperador"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:hint="Operador (+, -, *, /)"
            android:inputType="text" />
        <Button
            android:id="@+id/buttonCalcular"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:text="Calcular" />
        <TextView
            android:id="@+id/textViewResultado"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:text="@{viewModel.resultado}" />
    </LinearLayout>
</layout>

- Calculadora.java
[source,java]
public class Calculadora {
    public double calcular(double value1, double value2, String operator) {
        switch (operator) {
            case "+":
                return value1 + value2;
            case "-":
                return value1 - value2;
            case "*":
                return value1 * value2;
            case "/":
                return value1 / value2;
            default:
                return 0;
        }
    }
}

- CalculadoraViewModel.java
[source,java]
import androidx.lifecycle.LiveData;
import androidx.lifecycle.MutableLiveData;
import androidx.lifecycle.ViewModel;
public class CalculadoraViewModel extends ViewModel {
    private final Calculadora calculadora;
    private final MutableLiveData<String> resultado;
    public CalculadoraViewModel(){
        calculadora = new Calculadora();
        resultado = new MutableLiveData<>();
    }
    public LiveData<String> getResultado() {
        return resultado;
    }
    public void calcular(double n1, double n2, String op) {
            double calculationResult = calculadora.calcular(n1, n2, op);
            resultado.setValue(String.valueOf(calculationResult));
    }
}

- MainActivity.java
[source,java]
import android.os.Bundle;
import android.view.View;
import androidx.appcompat.app.AppCompatActivity;
import androidx.lifecycle.ViewModelProvider;
import androidx.databinding.DataBindingUtil;
import nomeDoPacote.ActivityMainBinding;
public class MainActivity extends AppCompatActivity {
    private CalculadoraViewModel viewModel;
    private ActivityMainBinding binding;
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        binding = DataBindingUtil.setContentView(this, R.layout.activity_main);
        viewModel = new ViewModelProvider(this).get(CalculadoraViewModel.class);
        binding.setViewModel(viewModel);
        binding.setLifecycleOwner(this);
        binding.buttonCalcular.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                double n1 = Double.parseDouble(binding.editTextN1.getText().toString());
                double n2 = Double.parseDouble(binding.editTextN2.getText().toString());
                String op = binding.editTextOperador.getText().toString().trim();
                viewModel.calcular(n1, n2, op);
            }
        });
    }
}

Exemplo prático 02 (sem DataBinding e com ViewModel):

- activity_main.xml
[source,xml]
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout
    xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical"
    android:padding="16dp">
    <EditText
        android:id="@+id/editTextN1"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:hint="Número 1"
        android:inputType="numberDecimal"
        android:padding="8dp"
        android:textSize="16sp" />
    <EditText
        android:id="@+id/editTextN2"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:hint="Número 2"
        android:inputType="numberDecimal"
        android:padding="8dp"
        android:textSize="16sp" />
    <EditText
        android:id="@+id/editTextOp"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:hint="Operador (+, -, *, /)"
        android:inputType="text"
        android:padding="8dp"
        android:textSize="16sp" />
    <Button
        android:id="@+id/buttonCalculadora"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="Calcular"
        android:layout_marginTop="12dp"
        android:padding="8dp"
        android:textSize="16sp" />
    <TextView
        android:id="@+id/textViewResultado"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:text="Resultado: "
        android:textSize="18sp"
        android:paddingTop="16dp"
        android:textStyle="bold" />
</LinearLayout>

- Calculadora.java
[source,java]
public class Calculadora {
    public double calcular(double n1, double n2, String op) {
        switch (op) {
            case "+":
                return n1 + n2;
            case "-":
                return n1 - n2;
            case "*":
                return n1 * n2;
            case "/":
                    return n1 / n2;
            default:
               return 0;
        }
    }
}

- CalculadoraViewModel.java
[source,java]
import androidx.lifecycle.LiveData;
import androidx.lifecycle.MutableLiveData;
import androidx.lifecycle.ViewModel;
public class CalculadoraViewModel extends ViewModel {
    private final Calculadora modelo = new Calculadora();
    private final MutableLiveData<String> resultado = new MutableLiveData<>();
    public LiveData<String> getResultado() {
        return resultado;
    }
    public void calculate(double n1, double n2, String op) {
            double calculationResult = modelo.calcular(n1, n2, op);
            resultado.setValue("Resultado: " + calculationResult);
    }
}

- MainActivity.java
[source,java]
import android.os.Bundle;
import android.text.TextUtils;
import android.view.View;
import android.widget.Button;
import android.widget.EditText;
import android.widget.TextView;
import androidx.appcopat.app.AppCompatActivity;
import androidx.lifecycle.Observer;
import androidx.lifecycle.ViewModelProvider;
public class MainActivity extends AppCompatActivity {
    private CalculadoraViewModel viewModel;
    private TextView textViewResultado;
    private EditText editTextN1, editTextN2, editTextOp;
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        textViewResultado = findViewById(R.id.textViewResultado);
        Button buttonCalculadora = findViewById(R.id.buttonCalculadora);
        editTextN1 = findViewById(R.id.editTextN1);
        editTextN2 = findViewById(R.id.editTextN2);
        editTextOp = findViewById(R.id.editTextOp);
        viewModel = new ViewModelProvider(this).get(CalculadoraViewModel.class);
        viewModel.getResultado().observe(this, new Observer<String>() {
            @Override
            public void onChanged(String result) {
                textViewResultado.setText(result);
            }
        });
        buttonCalculadora.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                String s1 = editTextN1.getText().toString().trim();
                String s2 = editTextN2.getText().toString().trim();
                String op = editTextOp.getText().toString().trim();
                double n1 = Double.parseDouble(s1);
                double n2 = Double.parseDouble(s2);
                viewModel.calculate(n1, n2, op);
            }
        });
    }
}

Exemplo prático 03:

- Aluno.java (Model)
[source,java]
public class Aluno {
    private String nome;
    private int nota;
    public Aluno(String nome, int nota) {
        this.nome = nome;
        this.nota = nota;
    }
    public String getNome() {
        return nome;
    }
    public void setNome(String nome) {
        this.nome = nome;
    }
    public int getNota() {
        return nota;
    }
    public void setNota(int nota) {
        this.nota = nota;
    }
    @Override
    public String toString() {
        return "Aluno{" +
                "nome='" + nome + '\'' +
                ", nota=" + nota +
                '}';
    }
}

- AlunoRepositorio.java (Model)
[source,java]
import java.util.ArrayList;
import java.util.List;
public class AlunoRepositorio {
    public List<Aluno> obterDadosAlunos() {
        List<Aluno> listaAlunos = new ArrayList<>();
        listaAlunos.add(new Aluno("Ana", 6));
        listaAlunos.add(new Aluno("Rodrigo", 8));
        listaAlunos.add(new Aluno("Paulo", 7));
        return listaAlunos;
    }
}

- AlunoAdapter.java (Controller)
[source,java]
import android.content.Context;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ArrayAdapter;
import android.widget.TextView;
import java.util.List;
public class AlunoAdapter extends ArrayAdapter<Aluno> {
    public AlunoAdapter(Context context, List<Aluno> alunos) {
        super(context, 0, alunos);
    }
    @Override
    public View getView(int position, View convertView, ViewGroup parent) {
        Aluno aluno = getItem(position);
        if (convertView == null) {
            convertView = LayoutInflater.from(getContext())
                    .inflate(R.layout.item_aluno, parent, false);
        }
        TextView textViewNome = convertView.findViewById(R.id.textViewNome);
        TextView textViewNota = convertView.findViewById(R.id.textViewNota);
        if (aluno != null) {
            textViewNome.setText(aluno.getNome());
            textViewNota.setText("Nota: " + aluno.getNota());
        }
        return convertView;
    }
}

- AlunoViewModel.java (Controller)
[source,java]
import androidx.lifecycle.LiveData;
import androidx.lifecycle.MutableLiveData;
import androidx.lifecycle.ViewModel;
import java.util.List;
public class AlunoViewModel extends ViewModel {
    private final MutableLiveData<List<Aluno>> alunos;
    private final AlunoRepositorio alunoRepositorio;
    public AlunoViewModel() {
        alunos = new MutableLiveData<>();
        alunoRepositorio = new AlunoRepositorio();
        alunos.setValue(alunoRepositorio.obterDadosAlunos());
    }
    public LiveData<List<Aluno>> getAlunos() {
        return alunos;
    }
}

- activity_main.xml (View)
[source,xml]
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical"
    android:padding="16dp">
    <ListView
        android:id="@+id/listViewAlunos"
        android:layout_width="match_parent"
        android:layout_height="match_parent" />
</LinearLayout>

- item_aluno.xml (View)
[source,xml]
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:orientation="vertical"
    android:padding="12dp">
    <TextView
        android:id="@+id/textViewNome"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="Nome"
        android:textSize="18sp"
        android:textStyle="bold" />
    <TextView
        android:id="@+id/textViewNota"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="Nota"
        android:textSize="16sp" />
</LinearLayout>

- MainActivity.java (View)
[source,java]
import android.os.Bundle;
import android.widget.ListView;
import androidx.annotation.Nullable;
import androidx.appcompat.app.AppCompatActivity;
import androidx.lifecycle.Observer;
import androidx.lifecycle.ViewModelProvider;
import java.util.ArrayList;
import java.util.List;
public class MainActivity extends AppCompatActivity {
    private AlunoViewModel alunoViewModel;
    private ListView listViewAlunos;
    @Override
    protected void onCreate(@Nullable Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        listViewAlunos = findViewById(R.id.listViewAlunos);
        alunoViewModel = new ViewModelProvider(this).get(AlunoViewModel.class);
        final AlunoAdapter adapter = new AlunoAdapter(this, new ArrayList<Aluno>());
        listViewAlunos.setAdapter(adapter);
        alunoViewModel.getAlunos().observe(this, new Observer<List<Aluno>>() {
            @Override
            public void onChanged(List<Aluno> alunos) {
                adapter.clear();
                adapter.addAll(alunos);
                adapter.notifyDataSetChanged();
            }
        });
    }
}

Exemplo prático 04:

- Bolo.java
[source,java]
public class Bolo {
    private String nome;
    private String receita;
    public Bolo(String nome, String receita) {
        this.nome = nome;
        this.receita = receita;
    }
    public String getNome() {
        return nome;
    }
    public String getReceita() {
        return receita;
    }
}

- BoloRepositorio.java
[source,java]
import java.util.ArrayList;
import java.util.List;
public class BoloRepositorio {
    public List<Bolo> getBolos() {
        List<Bolo> bolos = new ArrayList<>();
        bolos.add(new Bolo("Bolo de Fubá", "Receita: Fubá, leite, ovos..."));
        bolos.add(new Bolo("Bolo de Chocolate", "Receita: Chocolate, leite, ovos..."));
        bolos.add(new Bolo("Bolo de Mandioca", "Receita: Mandioca, leite, ovos..."));
        return bolos;
    }
}

- BoloViewModel.java
[source,java]
import androidx.lifecycle.LiveData;
import androidx.lifecycle.MutableLiveData;
import androidx.lifecycle.ViewModel;
import java.util.List;
public class BoloViewModel extends ViewModel {
    private final BoloRepositorio repository = new BoloRepositorio();
    private final MutableLiveData<List<Bolo>> bolos = new MutableLiveData<>();
    public BoloViewModel() {
        loadBolos();
    }
    private void loadBolos() {
        bolos.setValue(repository.getBolos());
    }
    public LiveData<List<Bolo>> getBolos() {
        return bolos;
    }
}

- BoloAdapter.java
[source,java]
import android.content.Context;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ArrayAdapter;
import android.widget.TextView;
import java.util.List;
public class BoloAdapter extends ArrayAdapter<Bolo> {
    public BoloAdapter(Context context, List<Bolo> bolos) {
        super(context, 0, bolos);
    }
    @Override
    public View getView(int position, View convertView, ViewGroup parent) {
        Bolo bolo = getItem(position);
        if (convertView == null) {
            convertView = LayoutInflater.from(getContext())
                    .inflate(R.layout.item_bolo, parent, false);
        }
        TextView textViewNome = convertView.findViewById(R.id.textViewNome);
        if (bolo != null) {
            textViewNome.setText(bolo.getNome());
        }
        return convertView;
    }
}

- ReceitaFragment.java
[source,java]
import android.os.Bundle;
import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.fragment.app.Fragment;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.TextView;
public class ReceitaFragment extends Fragment {
    private static final String ARG_RECEITA = "receita";
    public static ReceitaFragment newInstance(String receita) {
        ReceitaFragment fragment = new ReceitaFragment();
        Bundle args = new Bundle();
        args.putString(ARG_RECEITA, receita);
        fragment.setArguments(args);
        return fragment;
    }
    @Nullable
    @Override
    public View onCreateView(@NonNull LayoutInflater inflater,
                             @Nullable ViewGroup container,
                             @Nullable Bundle savedInstanceState) {
        View view = inflater.inflate(R.layout.fragment_receita, container, false);
        TextView textViewReceita = view.findViewById(R.id.textViewReceita);

        if (getArguments() != null) {
            String receita = getArguments().getString(ARG_RECEITA);
            textViewReceita.setText(receita);
        }
        return view;
    }
}

- item_bolo.xml
[source,xml]
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:orientation="vertical"
    android:padding="16dp">
    <TextView
        android:id="@+id/textViewNome"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="Nome do bolo"
        android:textSize="18sp" />
</LinearLayout>

- fragment_receita.xml
[source,xml]
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical"
    android:padding="16dp">
    <TextView
        android:id="@+id/textViewReceita"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="Receita"
        android:textSize="18sp" />
</LinearLayout>

- activity_main.xml
[source,xml]
<?xml version="1.0" encoding="utf-8"?>
<RelativeLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent">
    <ListView
        android:id="@+id/listViewBolos"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:layout_alignParentTop="true" />
    <FrameLayout
        android:id="@+id/fragment_container"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:layout_below="@id/listViewBolos" />
</RelativeLayout>

- MainActivity.java
[source,java]
import android.os.Bundle;
import android.view.View;
import android.widget.AdapterView;
import android.widget.ListView;
import androidx.annotation.Nullable;
import androidx.appcompat.app.AppCompatActivity;
import androidx.lifecycle.Observer;
import androidx.lifecycle.ViewModelProvider;
import java.util.ArrayList;
import java.util.List;
public class MainActivity extends AppCompatActivity {
    private BoloViewModel boloViewModel;
    private ListView listViewBolos;
    @Override
    protected void onCreate(@Nullable Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        listViewBolos = findViewById(R.id.listViewBolos);
        boloViewModel = new ViewModelProvider(this).get(BoloViewModel.class);
        final BoloAdapter adapter = new BoloAdapter(this, new ArrayList<Bolo>());
        listViewBolos.setAdapter(adapter);
        boloViewModel.getBolos().observe(this, new Observer<List<Bolo>>() {
            @Override
            public void onChanged(List<Bolo> bolos) {
                adapter.clear();
                adapter.addAll(bolos);
                adapter.notifyDataSetChanged();
            }
        });
        listViewBolos.setOnItemClickListener(new AdapterView.OnItemClickListener() {
            @Override
            public void onItemClick(AdapterView<?> parent, View view, int position, long id) {
                Bolo bolo = adapter.getItem(position);
                if (bolo != null) {
                    ReceitaFragment fragment = ReceitaFragment.newInstance(bolo.getReceita());
                    getSupportFragmentManager().beginTransaction()
                            .replace(R.id.fragment_container, fragment)
                            .addToBackStack(null)
                            .commit();
                }
            }
        });
    }
}

== Exemplos práticos (Consumo/envio JSON com biblioteca remotamente) 

Inicialmente cria-se um novo projeto no Android Studio. No arquivo build.gradle (Module:app) deve ser adicionado a linha implementation ‘com.google.code.gson:gson:2.11.0'. No arquivo AndroidManifest.xml deve ser adicionado a linha <uses-permission android:name="android.permission.INTERNET"/>.

Neste exemplo, será consumido o JSON retornado da seguinte URL: https://jsonplaceholder.typicode.com/posts/. Antes de implementar a classe MainActivity, primeiro será criado a classe POJO derivada do arquivo JSON. Neste material será usado a biblioteca criada por joelittlejohn, disponível em: http://www.jsonschema2pojo.org/. Esse site permite fazer a conversão de JSON para classe POJO para ser usada com a biblioteca GSON. A figura 1 mostra o site.

image::json_pojo.png[]

- Para saber mais detalhes sobre as anotações @Expose e @SerializedName, acesse o link do site Stack Overflow: https://stackoverflow.com/questions/34752200/gson-expose-vs-serializedname. Pergunta realizada pelo usuário <https://stackoverflow.com/users/867591/ahmed-faisal> em 12 de jan. 2016 e respondida pelo usuário <https://stackoverflow.com/users/8942811/bek> em 7 de set. 2018.  Acesso em: 21 de ago. 2025.

Após a criação da class POJO, pode-se dar continuidade no projeto. Os códigos estão disponibilizados a seguir:

No arquivo AndroidManifest.xml adicione <uses-permission android:name="android.permission.INTERNET" />

- Conversao.java
[source,java]
import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
public class Conversao {
    public String converter(InputStream inputStream) {
        if (inputStream == null) return null;
        InputStreamReader inputStreamReader = new InputStreamReader(inputStream);
        BufferedReader bufferedReader = new BufferedReader(inputStreamReader);
        StringBuilder stringBuilder = new StringBuilder();
        String conteudo;
        try {
            while ((conteudo = bufferedReader.readLine()) != null) {
                stringBuilder.append(conteudo).append("\n");
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
        return stringBuilder.toString();
    }
}

- Conexao.java
[source,java]
import java.io.BufferedInputStream;
import java.io.IOException;
import java.io.InputStream;
import java.net.HttpURLConnection;
import java.net.URL;
public class Conexao {
    public InputStream obterRespostaHTTP(String end) {
        try {
            URL url = new URL(end);
            HttpURLConnection conexao = (HttpURLConnection) url.openConnection();
            conexao.setRequestMethod("GET");
            conexao.connect();
            return new BufferedInputStream(conexao.getInputStream());
        } catch (IOException e) {
            e.printStackTrace();
        }
        return null;
    }
}

- Item.java
[source,java]
import com.google.gson.annotations.Expose;
import com.google.gson.annotations.SerializedName;
public class Item {
    @SerializedName("userId")
    @Expose
    private Integer userId;
    @SerializedName("id")
    @Expose
    private Integer id;
    @SerializedName("title")
    @Expose
    private String title;
    @SerializedName("body")
    @Expose
    private String body;
    public Integer getUserId() { return userId; }
    public void setUserId(Integer userId) { this.userId = userId; }
    public Integer getId() { return id; }
    public void setId(Integer id) { this.id = id; }
    public String getTitle() { return title; }
    public void setTitle(String title) { this.title = title; }
    public String getBody() { return body; }
    public void setBody(String body) { this.body = body; }
    @Override
    public String toString() {
        return "Item{" +
                "userId=" + userId +
                ", id=" + id +
                ", title='" + title + '\'' +
                ", body='" + body + '\'' +
                '}';
    }
}

- activity_main.xml
[source,xml]
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical"
    android:padding="10dp"
    tools:context=".MainActivity">
    <ListView
        android:id="@+id/listViewDados"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:divider="@android:color/darker_gray"
        android:dividerHeight="1dp" />
</LinearLayout>

- MainActivity.java
[source,java]
import android.os.Bundle;
import androidx.activity.EdgeToEdge;
import androidx.appcompat.app.AppCompatActivity;
import androidx.core.graphics.Insets;
import androidx.core.view.ViewCompat;
import androidx.core.view.WindowInsetsCompat;
import androidx.appcompat.app.AppCompatActivity;
import android.os.AsyncTask;
import android.os.Bundle;
import android.util.Log;
import android.widget.ArrayAdapter;
import android.widget.ListView;
import android.widget.Toast;
import com.google.gson.Gson;
import com.google.gson.reflect.TypeToken;
import java.io.InputStream;
import java.lang.reflect.Type;
import java.util.ArrayList;
import java.util.List;
public class MainActivity extends AppCompatActivity {
    private ListView listView;
    private ArrayAdapter<String> adapter;
    private List<String> listaStrings;
    private final String URL = "https://jsonplaceholder.typicode.com/posts";
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        listView = findViewById(R.id.listViewDados);
        listaStrings = new ArrayList<>();
        adapter = new ArrayAdapter<>(this, android.R.layout.simple_list_item_1, listaStrings);
        listView.setAdapter(adapter);
        new obterDados().execute();
    }
    private class obterDados extends AsyncTask<Void, Void, List<Item>> {
        @Override
        protected void onPreExecute() {
            super.onPreExecute();
            Toast.makeText(getApplicationContext(), "Download começando...", Toast.LENGTH_SHORT).show();
        }
        @Override
        protected List<Item> doInBackground(Void... voids) {
            Conexao conexao = new Conexao();
            InputStream inputStream = conexao.obterRespostaHTTP(URL);
            Conversao Conversao = new Conversao();
            String textoJSON = Conversao.converter(inputStream);
            Log.i("JSON", "doInBackground: " + textoJSON);
            if (textoJSON != null) {
                Gson gson = new Gson();
                Type type = new TypeToken<List<Item>>() {}.getType();
                return gson.fromJson(textoJSON, type);
            }
            return null;
        }
        @Override
        protected void onPostExecute(List<Item> dadosBaixados) {
            super.onPostExecute(dadosBaixados);
            if (dadosBaixados != null) {
                listaStrings.clear();
                for (Item item : dadosBaixados) {
                    listaStrings.add("UserID: " + item.getUserId()
                            + "\nID: " + item.getId()
                            + "\nTítulo: " + item.getTitle()
                            + "\nBody: " + item.getBody());
                }
                adapter.notifyDataSetChanged();
            } else {
                Toast.makeText(getApplicationContext(), "Não foi possível obter JSON", Toast.LENGTH_SHORT).show();
            }
        }
    }
}

A classe AsyncTask foi descontinuada, segue a versão abaixo usando a classe Executor:

- AndroidManisfest.xml: <uses-permission android:name="android.permission.INTERNET"/>

- Arquivo Gradle: implementation("com.google.code.gson:gson:2.11.0")

- Item.java
[source,java]
import com.google.gson.annotations.Expose;
import com.google.gson.annotations.SerializedName;
public class Item {
    @SerializedName("userId")
    @Expose
    private Integer userId;
    @SerializedName("id")
    @Expose
    private Integer id;
    @SerializedName("title")
    @Expose
    private String title;
    @SerializedName("body")
    @Expose
    private String body;
    public Integer getUserId() { return userId; }
    public void setUserId(Integer userId) { this.userId = userId; }
    public Integer getId() { return id; }
    public void setId(Integer id) { this.id = id; }
    public String getTitle() { return title; }
    public void setTitle(String title) { this.title = title; }
    public String getBody() { return body; }
    public void setBody(String body) { this.body = body; }
    @Override
    public String toString() {
        return "Item{" +
                "userId=" + userId +
                ", id=" + id +
                ", title='" + title + '\'' +
                ", body='" + body + '\'' +
                '}';
    }
}

- Conexao.java
[source,java]
import java.io.BufferedInputStream;
import java.io.IOException;
import java.io.InputStream;
import java.net.HttpURLConnection;
import java.net.URL;
public class Conexao {
    public InputStream obterRespostaHTTP(String end) {
        try {
            URL url = new URL(end);
            HttpURLConnection conexao = (HttpURLConnection) url.openConnection();
            conexao.setRequestMethod("GET");
            conexao.connect();
            return new BufferedInputStream(conexao.getInputStream());
        } catch (IOException e) {
            e.printStackTrace();
        }
        return null;
    }
}

- Conversao.java
[source,java]
import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
public class Conversao {
    public String converter(InputStream inputStream) {
        if (inputStream == null) return null;

        InputStreamReader inputStreamReader = new InputStreamReader(inputStream);
        BufferedReader bufferedReader = new BufferedReader(inputStreamReader);
        StringBuilder stringBuilder = new StringBuilder();
        String conteudo;
        try {
            while ((conteudo = bufferedReader.readLine()) != null) {
                stringBuilder.append(conteudo).append("\n");
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
        return stringBuilder.toString();
    }
}

- activity_main.xml
[source,xml]
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical"
    android:padding="10dp"
    tools:context=".MainActivity">
    <ListView
        android:id="@+id/listViewDados"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:divider="@android:color/darker_gray"
        android:dividerHeight="1dp" />
</LinearLayout>

- MainActivity.java
[source,java]
import androidx.appcompat.app.AppCompatActivity;
import android.os.Bundle;
import android.os.Handler;
import android.os.Looper;
import android.util.Log;
import android.widget.ArrayAdapter;
import android.widget.ListView;
import android.widget.Toast;
import com.google.gson.Gson;
import com.google.gson.reflect.TypeToken;
import java.io.InputStream;
import java.lang.reflect.Type;
import java.util.ArrayList;
import java.util.List;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;
public class MainActivity extends AppCompatActivity {
    private ListView listView;
    private ArrayAdapter<String> adapter;
    private List<String> listaStrings;
    private final String URL = "https://jsonplaceholder.typicode.com/posts";
    private List<Item> dadosBaixados;
    private ExecutorService executorService;
    private Handler mainHandler;
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        listView = findViewById(R.id.listViewDados);
        listaStrings = new ArrayList<>();
        adapter = new ArrayAdapter<>(this, android.R.layout.simple_list_item_1, listaStrings);
        listView.setAdapter(adapter);
        executorService = Executors.newSingleThreadExecutor();
        mainHandler = new Handler(Looper.getMainLooper());
        obterDados();
    }

    private void obterDados() {
        Toast.makeText(getApplicationContext(), "Download começando...", Toast.LENGTH_SHORT).show();
        executorService.execute(() -> {
            try {
                Conexao conexao = new Conexao();
                InputStream inputStream = conexao.obterRespostaHTTP(URL);
                Conversao conversao = new Conversao();
                String textoJSON = conversao.converter(inputStream);
                Log.i("JSON", "doInBackground: " + textoJSON);
                if (textoJSON != null) {
                    Gson gson = new Gson();
                    Type type = new TypeToken<List<Item>>() {}.getType();
                    dadosBaixados = gson.fromJson(textoJSON, type);
                }
                List<String> finalLista = new ArrayList<>();
                if (dadosBaixados != null) {
                    for (Item item : dadosBaixados) {
                        finalLista.add("UserID: " + item.getUserId()
                                + "\nID: " + item.getId()
                                + "\nTítulo: " + item.getTitle()
                                + "\nBody: " + item.getBody());
                    }
                }
                mainHandler.post(() -> {
                    if (dadosBaixados != null) {
                        listaStrings.clear();
                        listaStrings.addAll(finalLista);
                        adapter.notifyDataSetChanged();
                    } else {
                        Toast.makeText(getApplicationContext(), "Não foi possível obter JSON", Toast.LENGTH_SHORT).show();
                    }
                });
            } catch (Exception e) {
                e.printStackTrace();
                mainHandler.post(() ->
                        Toast.makeText(getApplicationContext(), "Erro ao baixar dados", Toast.LENGTH_SHORT).show()
                );
            }
        });
    }
}

- Referências: As classes Conexao e Conversao foram adaptadas do site Stack Overflow (https://stackoverflow.com/questions/58889465/json-parsing-error-value-jsonstr-of-type-java-lang-string-cannot-be-converted-t) realizada pelo usuário Saad ( https://stackoverflow.com/users/7741722/saad) e respondida por Mike M. (https://stackoverflow.com/users/2850651/mike-m). Acesso em: 21 de ago. 2025.

 - Exemplos práticos (API JSON SERVER)

Neste exemplo, será usado uma biblioteca que permite criar uma API REST falsa destinada à testes. Para maiores detalhes sobre o biblioteca, acesse o endereço: https://github.com/typicode/json-server. Acesso em: 30 de jan. 2023.

Conforme mostra no endereço supracitado para instalar o json-server, basta abrir o terminal e digitar o comando:
npm install -g json-server

Atenção: É necessário ter o node.js instalado no computador para biblitoca funcionar. Em seguida, crie um arquivo com extensão.json, por exemplo db.json, banco.json, dados.json, etc.

db.json
[source,xml]
{
   "agenda" : [
    { "id" : 1 , "nome" : "Ana" , "telefone" : "1111-1111"  },
    { "id" : 2 , "nome" : "Helder" , "telefone" : "2222-2222"  },
    { "id" : 3 , "nome" : "Fagno" , "telefone" : "3333-3333"  }
  ],
  "adicionais" : [
    { "id" : 1 , "email" : "ana@ifto.edu.br"},
    { "id" : 2 , "email" : "helder@ifto.edu.br"},
    { "id" : 3 , "email" : "fagno@ifto.edu.br"}
  ]
  }

Após salvar o arquivo abre o terminal e vamos ligar o servidor usando o comando:
json-server db.json

Se tudo deu certo, a seguinte mensagem será impressa no terminal:
   
  \{^_^}/ hi!
  Loading db.json
  Done

  Resources
  http://localhost:3000/agenda    //o conteúdo do arquivo db.json, porém mostrando o conteúdo do array agenda
  http://localhost:3000/adicionais   //o conteúdo do arquivo db.json,  porém mostrando o conteúdo do array adicionais
  
Infelizmente, não é possível consumir o arquivo disponibilizado pelo endereço: http://localhost:3000, pois o Android, por questões de segurança, atualmente aceita apenas comunicação via HTTPS. Mas a equipe que desenvolveu a biblioteca também disponibiliza um servidor com HTTPS chamado My JSON Server cujo o endereço para acesso é: https://my-json-server.typicode.com/.
Na página Web supracitada tem-se os passos necessários para usar o servidor. São etapas simples, como pode ser vista a seguir:

- Crie uma conta no GitHub;
- Crie um repositório;
- Crie um arquivo chamado db.json (coloque o conteúdo já disponibilizado neste exemplo).
- Acesse o endereço https://my-json-server.typicode.com/<coloque seu nome de usuário><coloque o nome do repositório criado>

E pronto, o seu arquivo json já estará disponível no servidor on-line. A figura 3 mostra o resultado.

Figura 3

image::resultado_json_server.png[]

Observe na figura 3 que  há 3 links clicáveis:

- na opção agenda, serão mostrados os dados contidos dentro do array agenda;

- na opção adicionais, serão mostrados os dados contidos dentro do array adicionais;

- e na opção db, serão mostrados tanto o array agenda e o adicionais com os conteúdos.

Agora, basta criar um app cliente no Android para consumir os dados disponíveis em: https://my-json-server.typicode.com/<seu nome de usuário no GitHub><seu repositório>/db.





